# Исправление переключения аудиоустройств

## Проблема

При переключении звука с Монитора на Наушники STT переставал получать аудио, т.к. устройство захвата не обновлялось.

## Решение

Добавлен динамический мониторинг аудиоустройств с автоматическим переключением.

## Что сделано

### 1. Созданы новые модули

- `device_monitor.py` - Мониторинг изменений аудиоустройств по умолчанию
- `dynamic_audio_capture.py` - Аудиозахват с автоматическим переключением
- `audio_mode_detector.py` - Определение режима (loopback/microphone)
- `stt_server_dynamic.py` - STT сервер с динамическим захватом

### 2. Обновлены файлы

- `main.js` - Запуск нового STT сервера с auto режимом
- `preload.js` - Добавлен API для переключения режима

## Как это работает

1. **Автоматическое определение**: Сервер автоматически определяет текущее аудиоустройство
2. **Мониторинг**: Каждую секунду проверяется, изменилось ли устройство по умолчанию
3. **Переключение**: При обнаружении изменения, захват аудио перезапускается с новым устройством
4. **Бесшовность**: Переключение происходит "на лету" без остановки сервера

## Использование

### Запуск с автоматическим определением

```bash
python python/stt_server_dynamic.py --mode auto
```

### Или через приложение

Приложение автоматически использует новый сервер с режимом `auto`.

## Проверка работы

1. Запустите приложение
2. Начните запись транскрипции
3. Переключите звук с Монитора на Наушники
4. Транскрипция продолжит работать с нового устройства

## Логи

При переключении устройства в логах появится:

```
[DeviceMonitor] Изменение устройства: "Monitor" -> "EDIFIER W820NB Plus"
[DynamicAudioCapture] Начало захвата с устройства: EDIFIER W820NB Plus
```

## Дополнительно

- Поддерживаются как loopback (системный звук), так и микрофон
- Можно принудительно переключить режим: `window.electronAPI.switchSTTMode('microphone')`
- Сервер автоматически подхватывает любые изменения аудиоустройств
